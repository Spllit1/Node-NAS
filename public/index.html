<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>File Server</title>
  <link rel="stylesheet" href="./index.css">
</head>
<body>
  <div class="ui">
      <h1 id="heading" class="text">NAS Server</h1>
      <form action="/upload" method="post" enctype="multipart/form-data" class="text">
        <input type="file" name="file">
        <br>
        <button class="text" style="color: black; margin-top: 5px;" type="submit">Upload</button>
      </form>
  
      <p class="infotext">/uploads/</p>
    
      <ul id="file-list" class="file-list text"></ul>

      <form id="create-folder-form">
        <label class="text" style="color: black" for="folderName">Folder name:</label>
        <input type="text" id="folderName" name="folderName">
        <button type="submit">Create folder</button>
      </form>
      
    </div>
  <script>
    document.getElementById('create-folder-form').addEventListener('submit', async (event) => {
    event.preventDefault();
  
    const folderName = document.getElementById('folderName').value;

  
    if (!folderName) {
      alert('Bitte geben Sie einen Ordnernamen ein.');
      return;
    }
  
    try {
      const response = await fetch('/create-folder', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({ folderName })
      });
  
      if (response.ok) {
        alert('Ordner erfolgreich erstellt.');
      } else {
        alert('Fehler beim Erstellen des Ordners.');
      }
    } catch (error) {
      console.error('Fehler beim Senden des Formulars:', error);
    }
  });


    function fetchAndDisplayFiles() {
      fetch('/list')
        .then((response) => response.json())
        .then((items) => {
          const fileList = document.getElementById('file-list');
          fileList.innerHTML = '';
          items.forEach((item) => {
            const li = document.createElement('li');
            li.textContent = item.name;

            const downloadButton = document.createElement('button');
            downloadButton.innerHTML = '<svg class="download-icon svg" xmlns="http://www.w3.org/2000/svg" height="1em" viewBox="0 0 384 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com/ License - https://fontawesome.com/license (Commercial License) Copyright 2023 Fonticons, Inc. --><path d="M64 0C28.7 0 0 28.7 0 64V448c0 35.3 28.7 64 64 64H320c35.3 0 64-28.7 64-64V160H256c-17.7 0-32-14.3-32-32V0H64zM256 0V128H384L256 0zM216 232V334.1l31-31c9.4-9.4 24.6-9.4 33.9 0s9.4 24.6 0 33.9l-72 72c-9.4 9.4-24.6 9.4-33.9 0l-72-72c-9.4-9.4-9.4-24.6 0-33.9s24.6-9.4 33.9 0l31 31V232c0-13.3 10.7-24 24-24s24 10.7 24 24z"/></svg>';
            downloadButton.onclick = () => {
              window.location.href = `/download/${encodeURIComponent(item.name)}`;
            };

            const renameButton = document.createElement('button');
            renameButton.innerHTML = '<svg class="svg" xmlns="http://www.w3.org/2000/svg" height="1em" viewBox="0 0 512 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com/ License - https://fontawesome.com/license (Commercial License) Copyright 2023 Fonticons, Inc. --><path d="M362.7 19.3L314.3 67.7 444.3 197.7l48.4-48.4c25-25 25-65.5 0-90.5L453.3 19.3c-25-25-65.5-25-90.5 0zm-71 71L58.6 323.5c-10.4 10.4-18 23.3-22.2 37.4L1 481.2C-1.5 489.7 .8 498.8 7 505s15.3 8.5 23.7 6.1l120.3-35.4c14.1-4.2 27-11.8 37.4-22.2L421.7 220.3 291.7 90.3z"/></svg>'; 
            renameButton.onclick = () => {
              const newName = prompt('Neuer Dateiname:');
              if (newName) {
                fetch('/rename', {
                  method: 'POST',
                  headers: { 'Content-Type': 'application/json' },
                  body: JSON.stringify({ oldName: item.name, newName }),
                }).then((response) => {
                  alert(response.statusText);
                  fetchAndDisplayFiles();
                });
              }
            };

            const deleteButton = document.createElement('button');
            deleteButton.innerHTML = '<svg class="delete-icon svg" xmlns="http://www.w3.org/2000/svg" height="1em" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com/ License - https://fontawesome.com/license (Commercial License) Copyright 2023 Fonticons, Inc. --><path d="M135.2 17.7L128 32H32C14.3 32 0 46.3 0 64S14.3 96 32 96H416c17.7 0 32-14.3 32-32s-14.3-32-32-32H320l-7.2-14.3C307.4 6.8 296.3 0 284.2 0H163.8c-12.1 0-23.2 6.8-28.6 17.7zM416 128H32L53.2 467c1.6 25.3 22.6 45 47.9 45H346.9c25.3 0 46.3-19.7 47.9-45L416 128z"/></svg>';
            deleteButton.onclick = () => {
              fetch(`/delete/${encodeURIComponent(item.name)}`, { method: 'DELETE' })
                .then((response) => {
                  alert(response.statusText);
                  fetchAndDisplayFiles();
                });
            };

            li.appendChild(downloadButton);
            li.appendChild(renameButton);
            li.appendChild(deleteButton);

            fileList.appendChild(li);
          });
        });
    }

    fetchAndDisplayFiles();
  </script>
</body>
</html>